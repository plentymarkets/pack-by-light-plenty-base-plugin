plugins {
    id "java"
}

group 'com.plentymarkets.plentybase.plugin'
version '1.0'
sourceCompatibility = 1.8

repositories {
    mavenCentral()
    maven { url "https://jitpack.io" }
}

dependencies {
    testCompile group: 'junit', name: 'junit', version: '4.12'

    // https://mvnrepository.com/artifact/org.json/json
    compile group: 'org.json', name: 'json', version: '20190722'

    compileOnly fileTree(dir: '/workspace/plenty-tool/build/libs', include: 'plentyBase.jar')
    annotationProcessor fileTree(dir: '/workspace/plenty-tool/build/libs', include: 'plentyBase.jar')

    // https://mvnrepository.com/artifact/org.pf4j/pf4j
    compileOnly group: 'org.pf4j', name: 'pf4j', version: '3.1.0'
    annotationProcessor group: 'org.pf4j', name: 'pf4j', version: '3.1.0'
}

task fatJar(type: Jar) {
    String pluginId = "packByLight"

    // Name of plugin file
    baseName = pluginId

    manifest {
        attributes 'Plugin-Class': 'plentybase.plugin.hue.PluginStart',
                'Plugin-Id': pluginId,
                'Plugin-Version': "${project.version}",
                'Plugin-Provider': 'plentysystems AG'
    }
    // Include resources (plugin.json) in jar
    into 'resources', {
        from 'resources'
    }

    // Include compile dependencies in jar
    from {
        configurations.compile.collect { it.isDirectory() ? it : zipTree(it) }
    } {
        exclude "META-INF/*.SF"
        exclude "META-INF/*.DSA"
        exclude "META-INF/*.RSA"
    }
    with jar
}